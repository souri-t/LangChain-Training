# RAG ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - Docker Compose

Streamlit UI ã¨ FastAPI ã‚µãƒ¼ãƒãƒ¼ã€Ollama ã‚’ Docker Compose ã§ä¸€æ‹¬èµ·å‹•ã—ã¾ã™ã€‚

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
/workspace/RAG/
â”œâ”€â”€ docker-compose.yml         â† ã“ã“ã«ãƒ¡ã‚¤ãƒ³ã®è¨­å®š
â”œâ”€â”€ rag_chroma_app/            (Streamlit UI)
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ config.yaml
â”‚   â””â”€â”€ requirements.txt
â””â”€â”€ rag_api/                   (FastAPI ã‚µãƒ¼ãƒãƒ¼)
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ api_server.py
    â”œâ”€â”€ requirements.txt
    â””â”€â”€ README.md
```

## ğŸš€ èµ·å‹•æ–¹æ³•

### 1. åˆå›èµ·å‹•ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ï¼†èµ·å‹•ï¼‰

```bash
cd /workspace/RAG
docker-compose up --build
```

### 2. 2å›ç›®ä»¥é™ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸å†åˆ©ç”¨ï¼‰

```bash
cd /workspace/RAG
docker-compose up
```

### 3. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•

```bash
docker-compose up -d
```

### 4. åœæ­¢

```bash
docker-compose down
```

### 5. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚‚å‰Šé™¤ï¼‰

```bash
docker-compose down -v
```

---

## ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆ

èµ·å‹•å¾Œã€ä»¥ä¸‹ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼š

| ã‚µãƒ¼ãƒ“ã‚¹ | URL | ãƒãƒ¼ãƒˆ |
|---------|-----|--------|
| **Streamlit UI** | http://localhost:8501 | 8501 |
| **FastAPI Docs** | http://localhost:8000/docs | 8000 |
| **FastAPI ReDoc** | http://localhost:8000/redoc | 8000 |
| **Ollama API** | http://localhost:11434 | 11434 |

---

## ğŸ”§ ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§

### 1. Ollamaï¼ˆåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰
- **ãƒãƒ¼ãƒˆ**: 11434
- **æ©Ÿèƒ½**: ãƒ†ã‚­ã‚¹ãƒˆåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè¡Œ
- **èµ·å‹•æ¡ä»¶**: æœ€åˆã«èµ·å‹•
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: `/api/tags` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 2. FastAPI ã‚µãƒ¼ãƒãƒ¼
- **ãƒãƒ¼ãƒˆ**: 8000
- **æ©Ÿèƒ½**: RESTful API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - GET `/api/files` - ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
  - POST `/api/search` - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
- **èµ·å‹•æ¡ä»¶**: Ollama èµ·å‹•å¾Œ
- **ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰**: æœ‰åŠ¹

### 3. Streamlit UI
- **ãƒãƒ¼ãƒˆ**: 8501
- **æ©Ÿèƒ½**: Webãƒ™ãƒ¼ã‚¹ã® UI
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
  - ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º
- **èµ·å‹•æ¡ä»¶**: FastAPI èµ·å‹•å¾Œ

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

```bash
# ãƒãƒ¼ãƒˆç¢ºèª
lsof -i :8501
lsof -i :8000
lsof -i :11434

# æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
docker-compose down
```

### Q: ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å†ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¦å†ãƒ“ãƒ«ãƒ‰
docker-compose build --no-cache
docker-compose up
```

### Q: ãƒ­ã‚°ã‚’ç¢ºèªã—ãŸã„

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
docker-compose logs -f

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
docker-compose logs -f api
docker-compose logs -f streamlit
docker-compose logs -f ollama
```

### Q: ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚ŠãŸã„

```bash
# FastAPI ã‚³ãƒ³ãƒ†ãƒŠ
docker-compose exec api bash

# Streamlit ã‚³ãƒ³ãƒ†ãƒŠ
docker-compose exec streamlit bash

# Ollama ã‚³ãƒ³ãƒ†ãƒŠ
docker-compose exec ollama bash
```

### Q: Ollama ã§ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„

```bash
# å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
docker-compose exec ollama ollama pull embeddinggemma

# ã¾ãŸã¯
docker-compose exec ollama ollama pull nomic-embed-text
```

---

## ğŸ“Š ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Compose Network (rag_network)     â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Streamlit   â”‚â”€â”€â”€â”€â–ºâ”‚  FastAPI     â”‚             â”‚
â”‚  â”‚ (Port 8501)  â”‚     â”‚ (Port 8000)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                      â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                    â”‚                                â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚           â”‚  Ollama         â”‚                      â”‚
â”‚           â”‚ (Port 11434)    â”‚                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ ãƒœãƒªãƒ¥ãƒ¼ãƒ 

| ãƒœãƒªãƒ¥ãƒ¼ãƒ  | ãƒã‚¦ãƒ³ãƒˆå…ˆ | ç”¨é€” |
|-----------|-----------|------|
| `ollama_data` | `/root/.ollama` | Ollama ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ |
| `streamlit_cache` | `/root/.streamlit` | Streamlit ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| `.` (ãƒ›ã‚¹ãƒˆ) | `/workspace/RAG` | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ |

---

## ğŸ” ç’°å¢ƒå¤‰æ•°

### å…±é€š
- `PYTHONUNBUFFERED=1` - Python ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã‚’ç„¡åŠ¹åŒ–
- `CONFIG_PATH` - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

### Streamlit
- `API_URL=http://api:8000` - API ã‚µãƒ¼ãƒãƒ¼ã®URLï¼ˆDocker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ï¼‰

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

èµ·å‹•å‰ã«ç¢ºèªï¼š

- [ ] Docker ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- [ ] Docker Compose ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- [ ] ãƒãƒ¼ãƒˆ 8000, 8501, 11434 ãŒç©ºã„ã¦ã„ã‚‹
- [ ] ãƒ‡ã‚£ã‚¹ã‚¯ç©ºãå®¹é‡ãŒååˆ†ï¼ˆç‰¹ã« Ollama ãƒ¢ãƒ‡ãƒ«ï¼‰

---

## ğŸ¯ ã‚ˆãã‚ã‚‹ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 1: é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°

```bash
# ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ­ã‚°ã‚’ç¢ºèª
cd /workspace/RAG
docker-compose up

# ãƒ­ã‚°ã‚’ç›£è¦–ã—ãªãŒã‚‰é–‹ç™º
# ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã¯è‡ªå‹•ã§å†èª­ã¿è¾¼ã¿ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æœ‰åŠ¹ï¼‰
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 2: æœ¬ç•ªé‹ç”¨

```bash
# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f

# åœæ­¢
docker-compose down
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 3: ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ã¿å†èµ·å‹•

```bash
# API ã‚µãƒ¼ãƒãƒ¼ã®ã¿å†èµ·å‹•
docker-compose restart api

# Streamlit ã®ã¿å†èµ·å‹•
docker-compose restart streamlit
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [Streamlit with Docker](https://docs.streamlit.io/knowledge-base/tutorials/deploy/docker)
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/)
- [Ollama Documentation](https://github.com/ollama/ollama)

---

**æœ€çµ‚æ›´æ–°**: 2025-11-09  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
